# üóúÔ∏è Compressor - Optimiseur de Fichiers Multim√©dia

Une solution self-hosted compl√®te pour compresser et optimiser tous vos fichiers multim√©dia tout en conservant leur format original.

![Version](https://img.shields.io/badge/version-2.0.0-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Node](https://img.shields.io/badge/node-%3E%3D18.0.0-brightgreen.svg)
![Docker](https://img.shields.io/badge/docker-ready-blue.svg)

## üéØ Objectif

R√©duire la taille de vos fichiers multim√©dia sans changer leur format, avec une interface web moderne et un backend performant utilisant FFmpeg et Sharp.

## ‚ú® Fonctionnalit√©s

### üì∏ Images
- **Formats support√©s** : JPEG, PNG, WebP, AVIF, HEIC, TIFF, BMP
- **Compression intelligente** avec pr√©servation de la qualit√©
- **Redimensionnement automatique** selon vos besoins
- **Conversion de format** optionnelle
- **Optimisation des m√©tadonn√©es** (suppression EXIF)

### üéµ Audio
- **Formats support√©s** : MP3, FLAC, WAV, AAC, OGG, M4A
- **Compression variable** (CBR/VBR)
- **Normalisation du volume** automatique
- **Conversion multi-format** simultan√©e
- **R√©duction de fr√©quence d'√©chantillonnage**

### üé¨ Vid√©o
- **Formats support√©s** : MP4, AVI, MKV, WebM, MOV, FLV
- **Codecs modernes** : H.264, H.265/HEVC, VP9, AV1
- **Compression adaptative** selon le contenu
- **Redimensionnement et recadrage** automatique
- **Optimisation pour le streaming** web

### üìÑ Documents
- **PDF** : Compression des images int√©gr√©es
- **Optimisation de la structure** du document
- **Suppression des m√©tadonn√©es** sensibles

## üèóÔ∏è Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    HTTP/WebSocket    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ                 ‚îÇ
‚îÇ    Frontend     ‚îÇ                     ‚îÇ     Backend     ‚îÇ
‚îÇ   (HTML/CSS/JS) ‚îÇ                     ‚îÇ   (Node.js)     ‚îÇ
‚îÇ                 ‚îÇ                     ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                 ‚îÇ
                                                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ   File Upload   ‚îÇ    ‚îÇ  Processing     ‚îÇ    ‚îÇ   FFmpeg        ‚îÇ
‚îÇ   & Settings    ‚îÇ    ‚îÇ     Queue       ‚îÇ    ‚îÇ   Sharp         ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ   (Redis)       ‚îÇ    ‚îÇ   PDF-lib       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üöÄ Installation Rapide avec Docker

### Pr√©requis
- Docker et Docker Compose install√©s
- 2GB RAM minimum
- 10GB espace disque libre

### D√©ploiement en 3 √©tapes

```bash
# 1. Cloner le repository
git clone https://github.com/your-username/compressor.git
cd compressor

# 2. Configurer l'environnement
cp .env.example .env
nano .env  # Modifier JWT_SECRET et CORS_ORIGIN

# 3. Cr√©er les dossiers requis et lancer Compressor
mkdir logs uploads
docker-compose up -d
```

**C'est tout ! üéâ**

### Acc√®s √† l'application
- **Interface Web** : http://localhost:3001
- **API** : http://localhost:8081
- **Health Check** : http://localhost:8081/api/health

## üîß Configuration

### Variables d'environnement essentielles

```env
# S√©curit√© (OBLIGATOIRE √† changer)
JWT_SECRET=your-super-secret-key-change-this-NOW

# CORS (URLs autoris√©es)
CORS_ORIGIN=http://localhost:3001,https://your-domain.com

# Stockage
UPLOADS_PATH=./uploads
LOGS_PATH=./logs

# Performance
WORKER_CONCURRENCY=2
UPLOAD_MAX_SIZE=5368709120  # 5GB
```

### Param√®tres de compression par d√©faut

```json
{
  "images": {
    "quality": 80,
    "maxWidth": 1920,
    "maxHeight": 1080,
    "format": "auto"
  },
  "videos": {
    "codec": "h264",
    "crf": 23,
    "preset": "medium"
  },
  "audio": {
    "codec": "aac",
    "bitrate": "128k",
    "sampleRate": 44100
  }
}
```

## üìä Performances

### Performances typiques

| Type de fichier | Taille max | Temps de traitement | Compression moyenne |
|-----------------|------------|--------------------|--------------------|
| **Image JPEG**  | 50 MB      | 2-5 secondes       | 30-70%            |
| **Vid√©o HD**    | 2 GB       | 2-10 minutes       | 40-80%            |
| **Audio FLAC**  | 200 MB     | 10-30 secondes     | 50-90%            |
| **PDF**         | 100 MB     | 5-15 secondes      | 10-60%            |

### Stack Compressor

| Service | Port | R√¥le |
|---------|------|------|
| **compressor-frontend** | 3001 | Interface utilisateur |
| **compressor-app** | 8081 | API REST + WebSocket |
| **compressor-worker** | - | Traitement fichiers |
| **compressor-redis** | - | Queue + Cache |

## üõ†Ô∏è Utilisation

### Interface Web
1. **Glissez-d√©posez** vos fichiers dans la zone d'upload
2. **Ajustez** les param√®tres de compression (optionnel)
3. **Suivez** la progression en temps r√©el
4. **T√©l√©chargez** vos fichiers optimis√©s

### API REST

#### Upload d'un fichier
```bash
curl -X POST http://localhost:8081/api/upload \
  -F "file=@image.jpg" \
  -F 'settings={"quality":85,"maxWidth":1920}'
```

#### R√©cup√©rer le statut
```bash
curl http://localhost:8081/api/status/job-id
```

#### T√©l√©charger le r√©sultat
```bash
curl http://localhost:8081/api/download/job-id -o optimized-image.jpg
```

### WebSocket (Temps r√©el)
```javascript
const socket = io('http://localhost:8081');

socket.on('job-progress', (data) => {
    console.log(`Job ${data.jobId}: ${data.progress}%`);
});

socket.on('job-completed', (data) => {
    console.log(`Job termin√©: ${data.compressionRatio}% de compression`);
});
```

## üîç Monitoring et Logs

### Commandes utiles

```bash
# Voir l'√©tat de la stack
docker-compose ps

# Logs en temps r√©el
docker-compose logs -f

# Stats de performance
docker stats compressor-app compressor-worker

# Health check
curl http://localhost:8081/api/health
```

### M√©triques disponibles
- **D√©bit** : Fichiers trait√©s par heure
- **Temps de traitement** moyen par type
- **Taux de compression** moyen
- **Utilisation CPU/M√©moire**
- **Files d'attente** Redis

## üîí S√©curit√©

### Mesures impl√©ment√©es
- **Rate limiting** par IP
- **Validation** stricte des fichiers upload√©s
- **Scan de signatures** (magic bytes)
- **Isolation Docker** compl√®te
- **JWT** pour authentification
- **CORS** configur√© strictement

### Recommandations production
- Utiliser HTTPS avec reverse proxy
- Configurer un pare-feu
- Limiter l'acc√®s r√©seau
- Surveiller l'espace disque
- Sauvegardes r√©guli√®res

## üõ†Ô∏è Maintenance

### Backup
```bash
# Sauvegarder les donn√©es
docker run --rm \
  -v compressor_uploads:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/compressor-backup-$(date +%Y%m%d).tar.gz -C /data .
```

### Mise √† jour
```bash
# Arr√™ter, mettre √† jour et red√©marrer
docker-compose down
git pull origin main
docker-compose build --no-cache
docker-compose up -d
```

### Nettoyage
```bash
# Nettoyer les fichiers temporaires
docker-compose exec compressor-app npm run cleanup

# Nettoyer Docker
docker system prune -a
```

## üêõ D√©pannage

### Probl√®mes courants

#### L'application ne d√©marre pas
```bash
# V√©rifier les logs
docker-compose logs compressor-app

# V√©rifier la configuration
docker-compose config

# Rebuilder compl√®tement
docker-compose build --no-cache
```

#### Erreur de connexion Redis
```bash
# V√©rifier Redis
docker-compose logs compressor-redis

# Red√©marrer Redis
docker-compose restart compressor-redis
```

#### Upload √©choue
```bash
# V√©rifier l'espace disque
df -h

# V√©rifier les permissions
ls -la uploads/

# V√©rifier les logs d'upload
docker-compose logs compressor-app | grep upload
```

#### Port d√©j√† utilis√©
```bash
# Trouver quel processus utilise le port
sudo lsof -i :8081

# Modifier le port dans docker-compose.yml si n√©cessaire
# Changer "8081:8000" vers "8082:8000" par exemple
```

### Fichiers manquants

Si vous rencontrez des erreurs de montage de volumes :

```bash
# Cr√©er les dossiers requis
mkdir -p logs uploads nginx

# V√©rifier la structure
ls -la
# Doit afficher : logs/ uploads/ nginx/ backend/ frontend/
```

## üöÄ D√©ploiement Production

### Configuration serveur

```bash
# Configurer les variables de production
cp .env.example .env
nano .env

# Variables critiques √† modifier :
JWT_SECRET=your-super-secure-generated-key-here
CORS_ORIGIN=https://compressor.yourdomain.com
UPLOADS_PATH=/data/compressor/uploads
LOGS_PATH=/var/log/compressor
WORKER_CONCURRENCY=4
```

### Avec reverse proxy (recommand√©)

```nginx
# Configuration Nginx reverse proxy
server {
    listen 80;
    server_name compressor.yourdomain.com;
    
    # Frontend
    location / {
        proxy_pass http://localhost:3001;
    }
    
    # API
    location /api/ {
        proxy_pass http://localhost:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## ü§ù Contribution

1. **Fork** le projet
2. **Cr√©er** une branche feature (`git checkout -b feature/amazing-feature`)
3. **Commit** vos changements (`git commit -m 'Add amazing feature'`)
4. **Push** vers la branche (`git push origin feature/amazing-feature`)
5. **Ouvrir** une Pull Request

### Guidelines
- Code format√© avec Prettier
- Tests unitaires pour nouvelles fonctionnalit√©s
- Documentation mise √† jour
- Commits conventionnels

## üìù Roadmap

### Version 2.1
- [ ] Support WebAssembly pour compression c√¥t√© client
- [ ] Interface mobile d√©di√©e  
- [ ] Compression batch programm√©e
- [ ] Int√©gration cloud storage (S3, GCS)

### Version 2.2
- [ ] Machine Learning pour compression optimale
- [ ] API GraphQL
- [ ] Plugin WordPress/Drupal
- [ ] Support formats RAW photo

### Version 3.0
- [ ] Clustering multi-serveurs
- [ ] CDN int√©gr√©
- [ ] Compression temps r√©el streaming
- [ ] Interface admin avanc√©e

## üÜò Support

### Documentation
- [Wiki complet](https://github.com/your-username/compressor/wiki)
- [FAQ](https://github.com/your-username/compressor/wiki/FAQ)
- [Troubleshooting](https://github.com/your-username/compressor/wiki/Troubleshooting)

### Communaut√©
- [Discord](https://discord.gg/compressor)
- [Issues GitHub](https://github.com/your-username/compressor/issues)

### Support commercial
- Email : support@compressor.com

## üìÑ License

Ce projet est sous licence MIT. Voir le fichier [LICENSE](LICENSE) pour plus de d√©tails.

## üôè Remerciements

- **FFmpeg** pour le moteur de traitement multim√©dia
- **Sharp** pour le traitement d'images avanc√©
- **Redis** pour la gestion des queues
- La communaut√© **open source** pour les contributions

---

**Made with ‚ù§Ô∏è by Compressor Team**

> üí° **Astuce** : Commencez par `docker-compose up -d` pour un d√©ploiement rapide, puis personnalisez selon vos besoins !

## üöÄ D√©marrage rapide

```bash
git clone https://github.com/your-username/compressor.git
cd compressor
cp .env.example .env
nano .env  # Changer JWT_SECRET
mkdir logs uploads
docker-compose up -d
```

**Votre Compressor est pr√™t sur http://localhost:3001 ! üéâ**

---

## üìã Points d'Acc√®s Rapides

| Service | URL | Description |
|---------|-----|-------------|
| üé® **Interface** | http://localhost:3001 | Application web principale |
| üîß **API** | http://localhost:8081 | Backend REST |
| üè• **Sant√©** | http://localhost:8081/api/health | Monitoring syst√®me |
| üì§ **Upload** | http://localhost:8081/api/upload | Endpoint d'upload |
| üìä **M√©triques** | http://localhost:8081/api/health/metrics | M√©triques d√©taill√©es |

### üîß Commandes de Maintenance Rapides

```bash
# Status complet
docker-compose ps && curl -s http://localhost:8081/api/health | jq

# Red√©marrage rapide
docker-compose restart

# Logs en temps r√©el
docker-compose logs -f --tail=50

# Nettoyage complet
docker-compose down && docker system prune -f && docker-compose up -d
```